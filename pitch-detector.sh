#!/bin/bash

notes=()
notes[21]="A0"
notes[22]="A#0"
notes[23]="B0"
notes[24]="C1"
notes[25]="C#1"
notes[26]="D1"
notes[27]="D#1"
notes[28]="E1"
notes[29]="F1"
notes[30]="F#1"
notes[31]="G1"
notes[32]="G#1"
notes[33]="A1"
notes[34]="A#1"
notes[35]="B1"
notes[36]="C2"
notes[37]="C#2"
notes[38]="D2"
notes[39]="D#2"
notes[40]="E2"
notes[41]="F2"
notes[42]="F#2"
notes[43]="G2"
notes[44]="G#2"
notes[45]="A2"
notes[46]="A#2"
notes[47]="B2"
notes[48]="C3"
notes[49]="C#3"
notes[50]="D3"
notes[51]="D#3"
notes[52]="E3"
notes[53]="F3"
notes[54]="F#3"
notes[55]="G3"
notes[56]="G#3"
notes[57]="A3"
notes[58]="A#3"
notes[59]="B3"
notes[60]="C4"
notes[61]="C#4"
notes[62]="D4"
notes[63]="D#4"
notes[64]="E4"
notes[65]="F4"
notes[66]="F#4"
notes[67]="G4"
notes[68]="G#4"
notes[69]="A4"
notes[70]="A#4"
notes[71]="B4"
notes[72]="C5"
notes[73]="C#5"
notes[74]="D5"
notes[75]="D#5"
notes[76]="E5"
notes[77]="F5"
notes[78]="F#5"
notes[79]="G5"
notes[80]="G#5"
notes[81]="A5"
notes[82]="A#5"
notes[83]="B5"
notes[84]="C5"
notes[85]="C#5"
notes[86]="D6"
notes[87]="D#6"
notes[88]="E6"
notes[89]="F6"
notes[90]="F#6"
notes[91]="G6"
notes[92]="G#6"
notes[93]="A6"
notes[94]="A#6"
notes[95]="B6"

INPUTFILE=$1
INPUTFILE=${INPUTFILE##*/}
OUTPUTNOTE=$(aubionotes -i "$INPUTFILE" | awk 'FNR==2{print $1}')
OUTPUTINT=${OUTPUTNOTE%.*}
OUTPUTFILE="${notes[$OUTPUTINT]} $INPUTFILE"
echo "the output was $OUTPUTINT, the note would be ${notes[$OUTPUTINT]}, the filename would be $OUTPUTFILE"

mkdir -p output
o=$IFS
IFS=$(echo -en "\n\b")
cp $INPUTFILE "output/$OUTPUTFILE"
IFS=$o
